<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet-omnivore@0.3.4/leaflet-omnivore.min.js"></script>
  <script src="https://unpkg.com/leaflet.marker.rotate@0.2.2/dist/leaflet.rotatedMarker.js"></script>
  <script src="https://unpkg.com/leaflet-filelayer@0.8.0/dist/leaflet.filelayer.js"></script>
  <script src="https://unpkg.com/togeojson@3.0.1/togeojson.js"></script>
  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <style>
    #map { height: 100%; width: 100% }
    html, body { height: 100%; margin: 0; }
  </style>
</head>
<body>
  <div id="map"></div>

  <script>
    // Tile layers
    var OSM = L.tileLayer('http://tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors',
      minZoom: 0,
      maxNativeZoom: 19
    });

    var CDNGI = L.tileLayer('http://{s}.aerial.openstreetmap.org.za/ngi-aerial/{z}/{x}/{y}.jpg', {
      minZoom: 1,
      maxZoom: 22
    });

    var NGITOPO50k = L.tileLayer('http://htonl.dev.openstreetmap.org/ngi-tiles/tiles/50k/{z}/{x}/{-y}.png', {
      attribution: 'State Copyright &copy; 1996&ndash;2013 <a href="http://www.ngi.gov.za/">Chief Directorate: National Geo-spatial Information</a>',
      minZoom: 4,
      maxZoom: 20,
      maxNativeZoom: 15
    });

    var NGITOPO250k = L.tileLayer('http://htonl.dev.openstreetmap.org/ngi-tiles/tiles/250k/{z}/{x}/{-y}.png', {
      attribution: 'State Copyright &copy; 1996&ndash;2010 <a href="http://www.ngi.gov.za/">Chief Directorate: National Geo-spatial Information</a>',
      minZoom: 4,
      maxNativeZoom: 12
    });

    var googleSat = L.tileLayer('http://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', {
      maxZoom: 20,
      subdomains: ['mt0', 'mt1', 'mt2', 'mt3']
    });

    var StravaHeatmapOld = L.tileLayer('https://heatmap-external-{s}.strava.com/tiles/run/hot/{z}/{x}/{y}.png', {
      attribution: '<a href="https://www.strava.com/">© Strava 2017</a>',
      minZoom: 3,
      maxZoom: 22,
      maxNativeZoom: 11
    });

    var StravaHeatmapNew = L.tileLayer('http://heatmap-external-{s}.strava.com/tiles-auth/run/hot/{z}/{x}/{y}.png?v=19{header(Referer,strava.com)}', {
      attribution: '<a href="https://www.strava.com/">© Strava 2017</a>',
      minZoom: 3,
      maxZoom: 22,
      maxNativeZoom: 17
    });

    var OSMOver = L.tileLayer('https://api.mapbox.com/styles/v1/akkedisi/cj6wf07ok92fv2rqr1zbvjzb4/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoiYWtrZWRpc2kiLCJhIjoiY2o2d2VwdjBlMWpucjJxbDFlbzR1YTg5dSJ9.116Aq7uu6qkEfbnMbQr4xA', {
      attribution: '&copy; <a href="https://www.mapbox.com/about/maps/">Mapbox</a>, &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> | <a href="https://www.mapbox.com/map-feedback/" target="_blank"><strong>Improve this map</strong></a>',
      minZoom: 1,
      maxZoom: 22,
      maxNativeZoom: 20
    });

    // Custom GeoJSON layer
    var customLayer = L.geoJson(null, {
      style: function(feature) {
        return { color: 'magenta' };
      }
    });

    // Load GPX layer
    var Opsie1 = omnivore.gpx('Option1.gpx', null, customLayer);

    // Initialize the map
    var map = L.map('map', { layers: [OSM] }).setView([-33.8595856, 19.1825786], 12);

    // Base and overlay layers
    var baseMaps = {
      "Open Street Map": OSM,
      "CD:NGI 50k Topo": NGITOPO50k,
      "CD:NGI 250k Topo": NGITOPO250k,
      "CD:NGI Aerial": CDNGI,
      "Google Satellite": googleSat
    };

    var overlay = {
      "Drakensberg 2020 Opsie 1": Opsie1,
      "Strava Heatmap (Old)": StravaHeatmapOld,
      "OSM Overlay": OSMOver
    };

    // Add layer control
    var layerControl = L.control.layers(baseMaps, overlay).addTo(map);

    // Scale control
    L.control.scale({ imperial: false, maxWidth: 200 }).addTo(map);

    // Load GeoJSON for sheet50k
    $.getJSON('https://akkedis.github.io/sheet50k.json', function (data) {
      var sheets = L.geoJson(data, {
        style: {
          stroke: true,
          color: 'black',
          weight: 2,
          opacity: 1,
          fill: true,
          fillColor: 'lightblue',
          fillOpacity: 0
        },
        onEachFeature: function (feature, layer) {
          var props = feature.properties || {};
          var sheet = props.s || 'Unknown';
          var edition = props.e || 'Unknown';
          var year = props.y || 'Unknown';
          layer.bindPopup('Sheet No: ' + sheet + '<br/>Edition: ' + edition + '<br/>Year: ' + year);
        }
      });
      layerControl.addOverlay(sheets, "1:50k sheet info");
    }).fail(function (jqXHR, textStatus, errorThrown) {
      console.error('Error loading sheet50k.json:', textStatus, errorThrown);
    });

    // Load GeoJSON for sheet250k
    $.getJSON('https://akkedis.github.io/sheet250k.json', function (data) {
      var sheets = L.geoJson(data, {
        style: {
          stroke: true,
          color: 'black',
          weight: 2,
          opacity: 1,
          fill: true,
          fillColor: 'lightblue',
          fillOpacity: 0
        },
        onEachFeature: function (feature, layer) {
          var props = feature.properties || {};
          var sheet = props.s || 'Unknown';
          var edition = props.e || 'Unknown';
          var year = props.y || 'Unknown';
          layer.bindPopup('Sheet No: ' + sheet + '<br/>Edition: ' + edition + '<br/>Year: ' + year);
        }
      });
      layerControl.addOverlay(sheets, "1:250k sheet info");
    }).fail(function (jqXHR, textStatus, errorThrown) {
      console.error('Error loading sheet250k.json:', textStatus, errorThrown);
    });
  </script>
</body>
</html>
